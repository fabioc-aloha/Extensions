---
name: "mcp-server-patterns"
description: "MCP server development — MCP SDK, tool schemas, transport types, mcp.json, VS Code 1.109 integration"
---

# MCP Server Patterns Skill

**Trifecta**: Monorepo & Architecture (2 of 3)
**Activation**: MCP, mcp.json, Model Context Protocol, tool schema, transport, stdio, SSE, MCP App Starter
**Last Validated**: 2026-02-20 | VS Code 1.109

---

## What is MCP?

Model Context Protocol (MCP) is a standard for AI tools to expose capabilities to language models.
VS Code 1.109 made MCP stable — extensions can now expose tools via `mcp.json` that Copilot and other agents call.

Our MCP App Starter extension scaffolds new MCP servers. This skill covers the patterns it generates.

---

## MCP Server Types

| Transport | When to Use | VS Code Support |
|---|---|---|
| `stdio` | Local process, spawned by client | ✅ Full support in 1.109 |
| `sse` (HTTP SSE) | Remote server, HTTP-based | ✅ Supported via URL |
| `http` (Streamable) | Modern replacement for SSE | ✅ 1.109+ |

**MCP App Starter generates**: stdio transport (local process), the simplest and most reliable.

---

## mcp.json Configuration (Workspace Level)

`mcp.json` at workspace root tells VS Code which MCP servers to launch:

```json
{
  "servers": {
    "my-mcp-server": {
      "type": "stdio",
      "command": "node",
      "args": ["./dist/index.js"],
      "env": {
        "MY_API_KEY": "${input:myApiKey}"
      }
    }
  }
}
```

**VS Code 1.109 inputs** — prompts user for secrets (not hardcoded):
```json
{
  "inputs": [
    {
      "id": "myApiKey",
      "type": "promptString",
      "description": "Enter your API key",
      "password": true
    }
  ]
}
```

---

## MCP Server Scaffold (TypeScript)

`src/index.ts` generated by MCP App Starter:

```typescript
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { z } from 'zod';

const server = new McpServer({
    name: 'my-mcp-server',
    version: '0.1.0'
});

// Register a tool
server.tool(
    'my_tool',        // tool name (snake_case by convention)
    'Description of what this tool does',
    {
        // Zod schema for input validation
        input: z.object({
            query: z.string().describe('The query to process'),
            limit: z.number().optional().default(10).describe('Max results to return')
        })
    },
    async ({ input }) => {
        // Tool implementation
        const results = await processQuery(input.query, input.limit);
        
        return {
            content: [
                {
                    type: 'text',
                    text: JSON.stringify(results, null, 2)
                }
            ]
        };
    }
);

// Start server
const transport = new StdioServerTransport();
await server.connect(transport);
```

---

## Tool Schema Best Practices

```typescript
// ✅ Rich descriptions help the model use the tool correctly
server.tool(
    'search_extensions',
    'Search VS Code extensions by keyword. Returns extension metadata including install count and rating.',
    {
        input: z.object({
            query: z.string().describe('Search keywords (e.g., "git history", "prettier formatter")'),
            category: z.enum(['AI', 'Formatters', 'Linters', 'Other']).optional()
                .describe('Filter by marketplace category'),
            limit: z.number().min(1).max(50).default(10)
                .describe('Number of results to return (1-50, default 10)')
        })
    },
    async ({ input }) => { ... }
);

// ❌ Unhelpful descriptions
server.tool('search', 'search', { input: z.object({ q: z.string() }) }, async () => {});
```

---

## MCP Server package.json

```json
{
  "name": "my-mcp-server",
  "version": "0.1.0",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0",
    "zod": "^3.22.0"
  },
  "devDependencies": {
    "typescript": "^5.3.0",
    "@types/node": "^20.0.0"
  }
}
```

---

## MCP App Starter — What It Generates

When user picks TypeScript → creates:
```
my-server/
├── package.json          (as above)
├── tsconfig.json
├── src/
│   └── index.ts          (with 1 sample tool)
├── .vscode/
│   └── mcp.json          (wired to dist/index.js)
└── README.md
```

User gets a working MCP server on disk, registered in their workspace immediately.

---

## Debugging MCP Servers in VS Code 1.109

VS Code 1.109 includes built-in MCP server management:
- Command palette: `MCP: List Servers` — shows running servers
- Command palette: `MCP: Restart Server` — restarts a specific server
- Output panel: `MCP: my-server` — shows server stdout/stderr

For the MCP App Starter extension, this means:
1. Scaffold the server
2. Build it (`npm run build`)
3. VS Code reads `mcp.json`, launches the server
4. `MCP: List Servers` shows it running
5. Copilot can now use the server's tools

---

## Python MCP Server Pattern

When user picks Python in MCP App Starter:

```python
# src/server.py
from mcp.server import Server
from mcp.server.stdio import stdio_server
from mcp import types
import asyncio

app = Server("my-python-server")

@app.list_tools()
async def list_tools() -> list[types.Tool]:
    return [
        types.Tool(
            name="my_tool",
            description="Description of the tool",
            inputSchema={
                "type": "object",
                "properties": {
                    "query": {"type": "string", "description": "The query"}
                },
                "required": ["query"]
            }
        )
    ]

@app.call_tool()
async def call_tool(name: str, arguments: dict) -> list[types.TextContent]:
    if name == "my_tool":
        result = process(arguments["query"])
        return [types.TextContent(type="text", text=str(result))]
    raise ValueError(f"Unknown tool: {name}")

async def main():
    async with stdio_server() as (read_stream, write_stream):
        await app.run(read_stream, write_stream, app.create_initialization_options())

asyncio.run(main())
```

mcp.json for Python:
```json
{
  "servers": {
    "my-python-server": {
      "type": "stdio",
      "command": "python",
      "args": ["src/server.py"]
    }
  }
}
```
